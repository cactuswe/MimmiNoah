<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rita i realtid</title>
    <script type="module">
        // Importera Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, push, remove } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";

        // Firebase-konfiguration
        const firebaseConfig = {
            apiKey: "AIzaSyBDMAPvvCb1MFFWgVb_8GTpQYwMSAR9uBU",
            authDomain: "mimminoah-ee32a.firebaseapp.com",
            databaseURL: "https://mimminoah-ee32a-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mimminoah-ee32a",
            storageBucket: "mimminoah-ee32a.firebasestorage.app",
            messagingSenderId: "598999784847",
            appId: "1:598999784847:web:3de2bb39f019deeca27ffa"
        };

        // Initiera Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const drawingsRef = ref(db, "drawings");

        // HTML-element
        const canvas = document.createElement("canvas");
        document.body.appendChild(canvas);
        const ctx = canvas.getContext("2d");
        let drawing = false;
        let color = "#000000";

        // Anpassa canvas till skärmen
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        // Färgval
        const colorPicker = document.createElement("input");
        colorPicker.type = "color";
        colorPicker.style.position = "absolute";
        colorPicker.style.top = "10px";
        colorPicker.style.left = "10px";
        colorPicker.addEventListener("input", (e) => {
            color = e.target.value;
        });
        document.body.appendChild(colorPicker);

        // Ritningsfunktioner
        function startDrawing(e) {
            drawing = true;
            draw(e);
        }

        function stopDrawing() {
            drawing = false;
        }

        function draw(e) {
            if (!drawing) return;
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;

            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.arc(x, y, 5, 0, Math.PI * 2);
            ctx.fill();

            // Skicka data till Firebase
            push(drawingsRef, {
                x, y, color,
                timestamp: Date.now()
            });
        }

        // Eventlisteners
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("touchstart", startDrawing);
        canvas.addEventListener("touchmove", draw);
        canvas.addEventListener("touchend", stopDrawing);

        // Hämta data i realtid
        onValue(drawingsRef, (snapshot) => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            snapshot.forEach((child) => {
                const { x, y, color } = child.val();
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x, y, 5, 0, Math.PI * 2);
                ctx.fill();
            });
        });

        // Automatisk rensning av ritningar efter 24 timmar
        setInterval(() => {
            onValue(drawingsRef, (snapshot) => {
                snapshot.forEach((child) => {
                    if (Date.now() - child.val().timestamp > 24 * 60 * 60 * 1000) {
                        remove(ref(db, "drawings/" + child.key));
                    }
                });
            });
        }, 60000); // Kör rensningen varje minut
    </script>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { position: absolute; top: 0; left: 0; width: 100vw; height: 100vh; }
    </style>
</head>
<body>
</body>
</html>