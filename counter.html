<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>❤️</title>

  <!-- iOS WebApp-stöd -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icon-192.png">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      width: 100vw;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color: #333;
      overflow: hidden;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      flex-direction: column;
      touch-action: none;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    h1 {
      font-size: 1.8rem;
      margin-bottom: 10px;
      font-weight: 600;
    }

    #counter {
      font-size: 1.2rem;
      background: rgba(0, 0, 0, 0.05);
      padding: 15px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    #messagesContainer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-wrap: wrap;
      pointer-events: none;
    }

    .message {
      position: absolute;
      font-size: 1.5rem;
      font-weight: bold;
      color: #ff2d55;
      touch-action: none;
      cursor: grab;
      transition: transform 0.1s ease-out;
    }

    .message.placed {
      cursor: default;
      pointer-events: none;
    }
  </style>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      updateCounter();
      loadMessages();
      setInterval(updateCounter, 1000);
    });

    function updateCounter() {
      const startDate = new Date(2024, 5, 14);
      const now = new Date();
      const diff = dateDiffDetailed(startDate, now);

      document.getElementById("counter").innerHTML = `
        <div><strong>${diff.years}</strong> år</div>
        <div><strong>${diff.months}</strong> månader</div>
        <div><strong>${diff.days}</strong> dagar</div>
        <div><strong>${diff.hours}</strong> timmar</div>
        <div><strong>${diff.minutes}</strong> minuter</div>
        <div><strong>${diff.seconds}</strong> sekunder</div>
      `;
    }

    function dateDiffDetailed(start, end) {
      let years = end.getFullYear() - start.getFullYear();
      let months = end.getMonth() - start.getMonth();
      let days = end.getDate() - start.getDate();
      let hours = end.getHours() - start.getHours();
      let minutes = end.getMinutes() - start.getMinutes();
      let seconds = end.getSeconds() - start.getSeconds();

      if (seconds < 0) { seconds += 60; minutes--; }
      if (minutes < 0) { minutes += 60; hours--; }
      if (hours < 0) { hours += 24; days--; }
      if (days < 0) { months--; days += new Date(end.getFullYear(), end.getMonth(), 0).getDate(); }
      if (months < 0) { months += 12; years--; }

      return { years, months, days, hours, minutes, seconds };
    }

    // Firebase-konfiguration
    const firebaseConfig = {
      apiKey: "DIN-API-KEY",
      authDomain: "DITT-PROJEKT.firebaseapp.com",
      databaseURL: "https://DITT-PROJEKT.firebaseio.com",
      projectId: "DITT-PROJEKT",
      storageBucket: "DITT-PROJEKT.appspot.com",
      messagingSenderId: "DIN-SENDER-ID",
      appId: "DIN-APP-ID"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    document.addEventListener("click", (e) => {
      const x = e.clientX;
      const y = e.clientY;

      let message = prompt("Skriv ett gulligt meddelande ❤️");

      if (message && message.trim() !== "") {
        createMessageElement(message, x, y, true);
      }
    });

    function createMessageElement(text, x, y, isNew) {
      const msgElement = document.createElement("div");
      msgElement.classList.add("message");
      msgElement.style.left = `${x}px`;
      msgElement.style.top = `${y}px`;
      msgElement.textContent = text;
      document.getElementById("messagesContainer").appendChild(msgElement);

      let scale = 1;
      let posX = x;
      let posY = y;
      let isDragging = false;

      msgElement.addEventListener("touchstart", (e) => {
        if (msgElement.classList.contains("placed")) return;
        isDragging = true;
      });

      document.addEventListener("touchmove", (e) => {
        if (!isDragging || e.touches.length > 1) return;
        e.preventDefault();
        posX = e.touches[0].clientX;
        posY = e.touches[0].clientY;
        msgElement.style.left = `${posX}px`;
        msgElement.style.top = `${posY}px`;
      });

      document.addEventListener("touchend", () => {
        if (isDragging) {
          isDragging = false;
        }
      });

      msgElement.addEventListener("gesturechange", (e) => {
        if (msgElement.classList.contains("placed")) return;
        e.preventDefault();
        scale = Math.max(0.5, Math.min(3, e.scale));
        msgElement.style.transform = `scale(${scale})`;
      });

      msgElement.addEventListener("dblclick", () => {
        msgElement.classList.add("placed");
        if (isNew) {
          const timestamp = Date.now();
          db.ref("messages").push({ text, x: posX, y: posY, scale, timestamp });
        }
      });
    }

    function loadMessages() {
      const messagesContainer = document.getElementById("messagesContainer");
      const messagesRef = db.ref("messages");

      messagesRef.on("value", (snapshot) => {
        messagesContainer.innerHTML = "";
        const now = Date.now();

        snapshot.forEach((child) => {
          const data = child.val();
          const timePassed = now - data.timestamp;

          if (timePassed < 3 * 60 * 60 * 1000) { // 3 timmar
            createMessageElement(data.text, data.x, data.y, false);
          } else {
            db.ref("messages").child(child.key).remove();
          }
        });
      });
    }
  </script>
</head>
<body>
  <h1>Vi har varit tillsammans i...</h1>
  <div id="counter"></div>
  <div id="messagesContainer"></div>
</body>
</html>